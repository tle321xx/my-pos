<div class="modal fade show" tabindex="-1" *ngIf="isOpen" 
     style="display: block; background: rgba(0,0,0,0.5); z-index: 1055;">
  <div class="modal-dialog modal-dialog-centered modal-lg">
    <div class="modal-content border-0 shadow">
      
      <div *ngIf="isLoading" class="p-5 text-center">
        <div class="spinner-border text-primary mb-2"></div>
        <p class="text-muted m-0">กำลังโหลดข้อมูลใบเสร็จ...</p>
      </div>

      <ng-container *ngIf="!isLoading && order">
        <div class="modal-header bg-primary text-white">
          <div>
            <h5 class="modal-title fw-bold">
              <i class="bi bi-receipt"></i> ใบเสร็จ {{ order.receipt_no }}
            </h5>
            <small class="opacity-75">
              <i class="bi bi-calendar3"></i> {{ order.created_at | date:'dd/MM/yyyy HH:mm' }} น.
            </small>
          </div>
          <button type="button" class="btn-close btn-close-white" (click)="closeModal()"></button>
        </div>

        <div class="modal-body p-0">
          <div class="row g-0">
            <div class="col-md-4 bg-light border-end p-4">
              <h6 class="fw-bold text-secondary mb-3">ข้อมูลการขาย</h6>
              <div class="mb-3">
  <label class="fw-bold text-muted small">พนักงานขาย</label>
  <div class="fs-5">{{ order?.staff_name || 'System' }}</div>
</div>
              <div class="mb-2">
                <small class="text-muted d-block">วิธีชำระเงิน</small>
                <span class="badge bg-secondary">{{ order.payment_method | uppercase }}</span>
              </div>
              <hr>
              <h6 class="fw-bold text-secondary mb-3">ลูกค้า</h6>
              <div *ngIf="order.customer_name; else noCustomer">
                <div class="mb-2">
                  <i class="bi bi-person-fill text-primary me-1"></i> 
                  <strong>{{ order.customer_name }}</strong>
                </div>
                <div class="mb-2 text-muted small" *ngIf="order.customer_phone">
                  <i class="bi bi-telephone-fill me-1"></i> {{ order.customer_phone }}
                </div>
              </div>
              <ng-template #noCustomer>
                <span class="text-muted fst-italic">- ลูกค้าทั่วไป -</span>
              </ng-template>
            </div>

            <div class="col-md-8 p-4">
              <h6 class="fw-bold text-secondary mb-3">รายการสินค้า ({{ order.items.length }} รายการ)</h6>
              
              <div class="table-responsive border rounded mb-3" style="max-height: 300px;">
                <table class="table table-sm table-striped mb-0">
                  <thead class="table-light sticky-top">
                    <tr>
                      <th class="ps-3">สินค้า</th>
                      <th class="text-center">จำนวน</th>
                      <th class="text-end pe-3">รวม</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr *ngFor="let item of order.items">
                      <td class="ps-3">
                        <div>{{ item.product_name }}</div>
                        <small class="text-muted" *ngIf="item.strain">({{ item.strain }})</small>
                      </td>
                      <td class="text-center">{{ item.quantity }}</td>
                      <td class="text-end pe-3">{{ item.total_line_price | number }}</td>
                    </tr>
                  </tbody>
                </table>
              </div>

              <div class="d-flex justify-content-between align-items-center bg-success bg-opacity-10 p-3 rounded border border-success">
                <span class="fw-bold text-success">ยอดสุทธิ</span>
                <span class="fs-4 fw-bold text-success">{{ order.total_price | number }} ฿</span>
              </div>
            </div>
          </div>
        </div>
      </ng-container>

      <div class="modal-footer bg-light" *ngIf="!isLoading">
        <button type="button" class="btn btn-secondary" (click)="closeModal()">ปิดหน้าต่าง</button>
      </div>

    </div>
  </div>
</div>